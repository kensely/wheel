
<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>é¦¬åˆ°æˆåŠŸï¼šæ–°æ˜¥å¤§è¼ªç›¤</title>
    <!-- å¤–éƒ¨è³‡æºè¼‰å…¥ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+TC:wght@400;700;900&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
    
    <style>
      html, body {
        overscroll-behavior: none;
        height: 100%;
        width: 100%;
        background: #2a0505;
        margin: 0;
        overflow-x: hidden;
      }
      body {
        font-family: 'Noto Sans TC', sans-serif;
        background: radial-gradient(circle at center, #7f1d1d 0%, #2a0505 100%);
      }
      .font-calligraphy { font-family: 'Ma Shan Zheng', cursive; }
      .font-signature { font-family: 'Zhi Mang Xing', cursive; }
      
      .particle {
        position: fixed;
        pointer-events: none;
        background: linear-gradient(135deg, #f59e0b, transparent);
        border-radius: 50%;
        z-index: 0;
        opacity: 0.3;
        animation: float-up linear infinite;
      }
      @keyframes float-up {
        0% { transform: translateY(110vh) translateX(0) scale(1); opacity: 0; }
        20% { opacity: 0.4; }
        80% { opacity: 0.4; }
        100% { transform: translateY(-10vh) translateX(50px) scale(0.5); opacity: 0; }
      }

      @keyframes burst {
        0% { transform: scale(1); filter: brightness(1); }
        40% { transform: scale(1.08); filter: brightness(1.5); }
        100% { transform: scale(1); filter: brightness(1); }
      }
      .animate-burst { animation: burst 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

      .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }
      
      .gold-border {
        border: 2px solid #f59e0b;
        box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
      }

      .btn-gold {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
      }

      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

      @keyframes load { from { transform: scaleX(0); } to { transform: scaleX(1); } }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <div id="bg-particles"></div>

    <script>
      const container = document.getElementById('bg-particles');
      for (let i = 0; i < 25; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const size = Math.random() * 5 + 2 + 'px';
        p.style.width = size;
        p.style.height = size;
        p.style.left = Math.random() * 100 + 'vw';
        p.style.animationDuration = Math.random() * 15 + 10 + 's';
        p.style.animationDelay = Math.random() * 5 + 's';
        container.appendChild(p);
      }
    </script>

    <script type="text/babel">
      const { useState, useEffect, useRef, useCallback } = React;

      const LIFF_ID = '1569792743-2S9Zy8IT';
      const GAS_URL = 'https://script.google.com/macros/s/AKfycbwsmCxklPsVoozRdPggUmh81IXatVZfWEG9dAD7iDkNwQHWJKoJe-idX4BLuUq7C5P2/exec';
      const PRIZES = ['5 æ¨‚é€é‡‘', '20 æ¨‚é€é‡‘', '15 æ¨‚é€é‡‘', '10 æ¨‚é€é‡‘'];
      const COLORS = ['#991b1b', '#f59e0b', '#7f1d1d', '#fbbf24'];
      const TEXT_COLORS = ['#fbbf24', '#7f1d1d', '#fde68a', '#991b1b'];

      const LuckyWheel = ({ onSpinStart, onSpinEnd, disabled }) => {
        const canvasRef = useRef(null);
        const containerRef = useRef(null);
        const currentRotation = useRef(0);

        const drawWheel = useCallback(() => {
          const canvas = canvasRef.current;
          if (!canvas) return;
          const ctx = canvas.getContext('2d');
          if (!ctx) return;
          const size = canvas.width;
          const centerX = size / 2;
          const centerY = size / 2;
          const radius = size / 2 - 10;
          const sliceAngle = (Math.PI * 2) / PRIZES.length;

          ctx.clearRect(0, 0, size, size);
          PRIZES.forEach((prize, i) => {
            const angle = i * sliceAngle;
            ctx.beginPath();
            ctx.fillStyle = COLORS[i % COLORS.length];
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, angle, angle + sliceAngle);
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(angle + sliceAngle / 2);
            ctx.textAlign = 'right';
            ctx.fillStyle = TEXT_COLORS[i % TEXT_COLORS.length];
            ctx.font = 'bold 20px Noto Sans TC';
            ctx.fillText(prize, radius - 30, 10);
            ctx.restore();
          });

          ctx.beginPath();
          ctx.arc(centerX, centerY, 45, 0, Math.PI * 2);
          ctx.fillStyle = '#f59e0b';
          ctx.fill();
          ctx.strokeStyle = '#2a0505';
          ctx.lineWidth = 4;
          ctx.stroke();

          ctx.fillStyle = '#2a0505';
          ctx.font = 'bold 20px Noto Sans TC';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText('æŠ½ç', centerX, centerY);
        }, []);

        useEffect(() => drawWheel(), [drawWheel]);

        const handleSpin = () => {
          if (disabled) return;
          onSpinStart();
          const extraDegrees = Math.floor(Math.random() * 360);
          const totalDegrees = currentRotation.current + (360 * 8) + extraDegrees;
          gsap.to(containerRef.current, {
            rotation: totalDegrees,
            duration: 5,
            ease: 'power4.out',
            onComplete: () => {
              currentRotation.current = totalDegrees;
              const normalizedDegree = (totalDegrees % 360);
              const prizeIndex = Math.floor(((360 - normalizedDegree + 270) % 360) / (360 / PRIZES.length));
              onSpinEnd(PRIZES[prizeIndex]);
            }
          });
        };

        return (
          <div className="relative flex items-center justify-center select-none scale-90 md:scale-100">
            <div className="absolute top-[-15px] left-1/2 -translate-x-1/2 z-20 w-10 h-12 filter drop-shadow-lg pointer-events-none">
              <svg viewBox="0 0 100 100" fill="#f59e0b">
                <path d="M50 100 L10 20 Q50 0 90 20 Z" />
              </svg>
            </div>
            <div ref={containerRef} className={`relative cursor-pointer transition-transform duration-300 ${disabled ? 'cursor-not-allowed opacity-90' : 'hover:scale-105 active:scale-95'}`} onClick={handleSpin}>
              <canvas ref={canvasRef} width={360} height={360} className="rounded-full shadow-2xl" />
              <div className="absolute inset-0 rounded-full pointer-events-none opacity-20 bg-gradient-to-tr from-white/0 via-white/30 to-white/0"></div>
            </div>
          </div>
        );
      };

      const App = () => {
        const [isSpinning, setIsSpinning] = useState(false);
        const [isSending, setIsSending] = useState(false);
        const [prize, setPrize] = useState(null);
        const [userId, setUserId] = useState('');
        const [userName, setUserName] = useState('');
        const [loading, setLoading] = useState(true);
        const [verifyCode, setVerifyCode] = useState('');
        const [copied, setCopied] = useState(false);

        useEffect(() => {
          const init = async () => {
            try {
              if (typeof liff !== 'undefined') {
                await liff.init({ liffId: LIFF_ID });
                if (liff.isLoggedIn()) {
                  const profile = await liff.getProfile();
                  setUserId(profile.userId);
                  setUserName(profile.displayName);
                } else {
                  if (!liff.isInClient()) liff.login();
                }
              }
            } catch (err) {
              console.warn('LIFF è¼‰å…¥å¤±æ•—:', err);
              setUserId('GUEST_' + Math.floor(Math.random() * 1000));
              setUserName('æ–°æ˜¥è³“å®¢');
            } finally {
              setTimeout(() => setLoading(false), 1200);
            }
          };
          init();
        }, []);

        const handleSpinEnd = (selectedPrize) => {
          const code = Array.from({length: 8}, () => 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'[Math.floor(Math.random() * 32)]).join('');
          setVerifyCode(code);
          setPrize(selectedPrize);
          setIsSpinning(false);
          
          fetch(GAS_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'save', userId, displayName: userName, prize: selectedPrize, code, timestamp: new Date().toISOString() }),
          }).catch(e => console.error('Data sync failed:', e));
        };

        const copyCode = () => {
          navigator.clipboard.writeText(verifyCode).then(() => {
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          });
        };

        const sendToLine = async () => {
          if (isSending) return;
          setIsSending(true);

          const messageText = `ğŸ§§ã€æ–°æ˜¥å¤§è¼ªç›¤ã€‘æ´»å‹•å¿«å ±ï¼\n\næ­å–œ ${userName} æŠ½ä¸­çé …ï¼š\nâœ¨ ${prize} âœ¨\n\nğŸ”‘ é ˜çé©—è­‰ç¢¼ï¼š${verifyCode}\n\nè«‹æ†‘æ­¤é©—è­‰ç¢¼æ–¼å®˜æ–¹å¸³è™Ÿå®Œæˆå…Œæ›ï¼`;

          try {
            if (typeof liff !== 'undefined' && liff.isInClient()) {
              const context = liff.getContext();
              if (context && (context.type === 'utou' || context.type === 'room' || context.type === 'group')) {
                await liff.sendMessages([{ type: 'text', text: messageText }]);
                liff.closeWindow();
              } else {
                if (liff.isApiAvailable('shareTargetPicker')) {
                  await liff.shareTargetPicker([{ type: 'text', text: messageText }]);
                } else {
                  throw new Error('No available method to send message');
                }
              }
            } else {
              alert('è«‹åœ¨ LINE App å…§ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œæˆ–æ‰‹å‹•è¤‡è£½é©—è­‰ç¢¼ã€‚');
            }
          } catch (err) {
            console.error('LINE Send Error:', err);
            alert('è‡ªå‹•å‚³é€å¤±æ•—ã€‚åŸå› å¯èƒ½æ˜¯ï¼š\n1. æ¬Šé™ä¸è¶³(chat_message.write)\n2. éèŠå¤©å®¤ç’°å¢ƒé–‹å•Ÿ\n\nè«‹æ”¹ç”¨ã€Œé»æ“Šè¤‡è£½é©—è­‰ç¢¼ã€ä¸¦æ‰‹å‹•å‚³é€ã€‚');
          } finally {
            setIsSending(false);
          }
        };

        if (loading) return (
          <div className="fixed inset-0 flex flex-col items-center justify-center z-50 bg-[#2a0505]">
            <div className="text-amber-500 font-calligraphy text-5xl animate-pulse mb-4">æ–°æ˜¥ç¥ˆç¦</div>
            <div className="w-48 h-1 bg-white/10 rounded-full overflow-hidden relative">
              <div className="absolute inset-0 bg-amber-500 origin-left" style={{animation: 'load 1.5s ease-out forwards'}}></div>
            </div>
          </div>
        );

        return (
          <main className="relative min-h-screen flex flex-col items-center justify-start py-8 px-4 overflow-y-auto scrollbar-hide">
            <div className="z-10 text-center mb-8">
              <h1 className="text-6xl md:text-7xl font-calligraphy text-amber-500 drop-shadow-[0_2px_15px_rgba(245,158,11,0.6)] mb-2">æ–°æ˜¥å¤§è¼ªç›¤</h1>
              <p className="text-amber-200/80 font-signature text-3xl">é‡‘é¾é¨°é›² â€§ è²¡é‹äº¨é€š</p>
            </div>

            <div className="glass-card gold-border rounded-[2.5rem] p-6 md:p-10 w-full max-w-md relative z-10 mb-8 overflow-hidden">
              <div className="absolute top-0 right-0 bg-amber-500 text-red-950 font-black px-5 py-1 rounded-bl-2xl shadow-lg text-xs tracking-tighter uppercase">Happy New Year</div>
              
              <LuckyWheel onSpinStart={() => setIsSpinning(true)} onSpinEnd={handleSpinEnd} disabled={isSpinning || !!prize} />

              {prize ? (
                <div className="mt-8 text-center animate-burst">
                  <p className="text-amber-200/60 text-sm mb-1 uppercase tracking-widest font-bold">Great Fortune</p>
                  <h2 className="text-5xl font-calligraphy text-amber-500 mb-6 drop-shadow-sm">{prize}</h2>
                  
                  <div className="bg-white/5 border border-amber-500/30 rounded-2xl p-4 mb-6 relative group overflow-hidden active:scale-95 transition-transform" onClick={copyCode}>
                    <p className="text-amber-500/50 text-[10px] uppercase tracking-[0.2em] mb-2 font-bold">Verification Code (Tap to Copy)</p>
                    <div className="text-3xl font-mono text-amber-400 font-black tracking-widest">{verifyCode}</div>
                    <div className="mt-2 text-xs text-amber-500/80 font-bold">
                      {copied ? 'âœ¨ é©—è­‰ç¢¼å·²è¤‡è£½' : 'ğŸ“‹ é»æ“Šå¯æ‰‹å‹•è¤‡è£½'}
                    </div>
                  </div>

                  <div className="space-y-3">
                    <button onClick={sendToLine} disabled={isSending} className={`w-full py-4 btn-gold text-red-950 font-black rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-2 text-lg ${isSending ? 'opacity-70 animate-pulse' : ''}`}>
                      <span>{isSending ? 'å‚³é€ä¸­...' : 'å‚³é€çµæœå› LINE'}</span>
                    </button>
                    <button onClick={() => window.location.reload()} className="w-full py-2 text-amber-500/60 hover:text-amber-500 transition-colors text-sm font-bold">
                      è¿”å›é¦–é  / å†æ¬¡æŒ‘æˆ°
                    </button>
                  </div>
                </div>
              ) : (
                <div className="mt-8 text-center">
                  <div className="inline-block px-6 py-2 rounded-full border border-amber-500/20 text-amber-200/50 text-sm animate-pulse">
                    {isSpinning ? 'é‡‘è¼ªæ—‹è½‰ï¼Œå¥½é‹å°‡è‡³...' : 'é»æ“Šè½‰ç›¤ä¸­å¿ƒé–‹å§‹ç¥ˆç¦'}
                  </div>
                </div>
              )}
            </div>

            <div className="glass-card border border-white/10 rounded-3xl p-6 w-full max-w-md z-10 mb-10">
              <h3 className="text-amber-500 font-black text-xl mb-4 flex items-center gap-3">
                <span className="w-1.5 h-6 bg-amber-500 rounded-full shadow-[0_0_10px_rgba(245,158,11,0.5)]"></span>
                æ´»å‹•è¾¦æ³•èˆ‡é ˜çèªªæ˜
              </h3>
              <div className="space-y-4 text-amber-100/70 text-sm leading-relaxed">
                <p className="flex items-start gap-2">
                  <span className="text-amber-500 mt-1">â—</span>
                  <span>æ´»å‹•æ—¥æœŸï¼š2025å¹´1æœˆ1æ—¥ è‡³ 2æœˆ28æ—¥ 23:59æ­¢ã€‚</span>
                </p>
                <p className="flex items-start gap-2">
                  <span className="text-amber-500 mt-1">â—</span>
                  <span>æ¯ä½ LINE å¥½å‹æ¯æ—¥äº«æœ‰ä¸€æ¬¡æ–°æ˜¥å¤§è¼ªç›¤æŠ½çæ©Ÿæœƒã€‚</span>
                </p>
                <p className="flex items-start gap-2 font-bold text-amber-200">
                  <span className="text-amber-500 mt-1">â—</span>
                  <span>ç²çå¾Œè«‹å‹™å¿…é»æ“Šã€å‚³é€çµæœå› LINEã€‘æŒ‰éˆ•ï¼Œä¸¦æ†‘é©—è­‰ç¢¼è‡³å®˜æ–¹å¸³è™Ÿé€²è¡Œé ˜çã€‚</span>
                </p>
                <p className="flex items-start gap-2">
                  <span className="text-amber-500 mt-1">â—</span>
                  <span>è‹¥è‡ªå‹•å‚³é€å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½é©—è­‰ç¢¼å‚³é€è‡³å®˜æ–¹å¸³è™Ÿã€‚</span>
                </p>
                <div className="pt-4 border-t border-white/5 text-[11px] text-amber-500/50 italic">
                  * æœ¬æ´»å‹•å—æœå‹™æ¢æ¬¾è¦ç¯„ï¼Œæœ¬å…¬å¸ä¿ç•™éš¨æ™‚ä¿®æ­£ã€æš«åœæˆ–çµ‚æ­¢æœ¬æ´»å‹•ä¹‹æ¬Šåˆ©ã€‚
                </div>
              </div>
            </div>

            <div className="z-10 text-center pb-10">
              <div className="flex items-center justify-center gap-6 mb-3">
                <div className="w-16 h-[1px] bg-gradient-to-r from-transparent to-amber-500/40"></div>
                <span className="text-amber-500/60 font-signature text-3xl tracking-widest">äº”æ¨‚é€é‡‘</span>
                <div className="w-16 h-[1px] bg-gradient-to-l from-transparent to-amber-500/40"></div>
              </div>
              <p className="text-amber-500/30 text-[9px] uppercase tracking-widest font-bold">Global Lucky System v3.2 â€§ Security Verified</p>
            </div>
          </main>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
